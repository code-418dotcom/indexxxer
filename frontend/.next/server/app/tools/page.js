(()=>{var e={};e.id=843,e.ids=[843],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1518:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>h,originalPathname:()=>p,pages:()=>c,routeModule:()=>m,tree:()=>l}),r(2709),r(4403),r(996);var a=r(170),i=r(5002),n=r(3876),o=r.n(n),s=r(6299),d={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>s[e]);r.d(t,d);let l=["",{children:["tools",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2709)),"/home/project/frontend/app/tools/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,4403)),"/home/project/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,996,23)),"next/dist/client/components/not-found-error"]}],c=["/home/project/frontend/app/tools/page.tsx"],p="/tools/page",h={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/tools/page",pathname:"/tools",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},4564:(e,t,r)=>{Promise.resolve().then(r.bind(r,6530))},3287:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3642,23)),Promise.resolve().then(r.t.bind(r,7586,23)),Promise.resolve().then(r.t.bind(r,7838,23)),Promise.resolve().then(r.t.bind(r,8057,23)),Promise.resolve().then(r.t.bind(r,7741,23)),Promise.resolve().then(r.t.bind(r,3118,23))},5303:()=>{},6530:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});var a=r(7247),i=r(8964);function n(){let[e,t]=(0,i.useState)(""),[r,n]=(0,i.useState)(""),[o,s]=(0,i.useState)(""),[d,l]=(0,i.useState)(null),[c,p]=(0,i.useState)(""),[h,m]=(0,i.useState)([]),[u,x]=(0,i.useState)(!1),[g,f]=(0,i.useState)([]),[b,y]=(0,i.useState)(!1);async function w(){try{let e=await fetch("/api/media/current",{cache:"no-store"});if(!e.ok){let r=await e.text().catch(()=>"");t(`Media current failed: ${e.status} ${r?"- "+r:""}`);return}let r=await e.json();l(r)}catch(e){t(`Media current fetch failed: ${e?.message||e}`)}}async function j(e){x(!0),t("");try{let r=new URL("/api/media/browse",window.location.origin);e&&r.searchParams.set("path",e);let a=await fetch(r.toString(),{cache:"no-store"});if(!a.ok){let e=await a.text().catch(()=>"");t(`Browse failed: ${a.status} ${e?"- "+e:""}`),m([]);return}let i=await a.json();p(i.current_rel_path||""),m(i.items||[])}catch(e){t(`Browse fetch failed: ${e?.message||e}`),m([])}finally{x(!1)}}async function S(e){t("");try{let r=await fetch(`/api/media/select?rel_path=${encodeURIComponent(e)}`,{method:"POST"});if(!r.ok){let e=await r.text().catch(()=>"");t(`Select failed: ${r.status} ${e?"- "+e:""}`);return}await w(),t(`Selected: ${e||"(root)"}`)}catch(e){t(`Select fetch failed: ${e?.message||e}`)}}async function v(e){t("");try{let r=new FormData;r.append("file",e);let a=await fetch("/api/performers/import-csv",{method:"POST",body:r}),i=await a.text().catch(()=>""),n={};try{n=i?JSON.parse(i):{}}catch{n={raw:i}}if(!a.ok){t(`CSV import failed: ${a.status} ${JSON.stringify(n)}`);return}t(`CSV import OK: created=${n.created} updated=${n.updated}`)}catch(e){t(`CSV import fetch failed: ${e?.message||e}`)}}async function k(){f(["Starting indexing..."]),y(!0),t("");try{let e=await fetch("/api/media/index",{method:"POST"});if(!e.ok){let t=await e.text();f(r=>[...r,`Error: ${e.status} ${t}`]),y(!1);return}let t=e.body?.getReader();if(!t){f(e=>[...e,"Error: No response body"]),y(!1);return}let r=new TextDecoder,a="";for(;;){let{done:e,value:i}=await t.read();if(e)break;let n=(a+=r.decode(i,{stream:!0})).split("\n");for(let e of(a=n.pop()||"",n))if(e.trim()&&e.startsWith("data: "))try{let t=JSON.parse(e.slice(6)),r=new Date(t.timestamp).toLocaleTimeString(),a=`[${r}] ${t.message}`;f(e=>[...e,a])}catch(t){f(t=>[...t,`Parse error: ${e}`])}}f(e=>[...e,"Indexing complete!"])}catch(e){f(t=>[...t,`Error: ${e?.message||e}`])}finally{y(!1)}}return(0,a.jsxs)("main",{style:{padding:24,maxWidth:1100,margin:"0 auto"},children:[a.jsx("a",{href:"/",style:{textDecoration:"none",color:"black",opacity:.75},children:"← Back"}),a.jsx("h1",{style:{marginTop:10,marginBottom:6},children:"Tools"}),a.jsx("div",{style:{opacity:.7,marginBottom:18},children:"Import performer CSV and browse/select a media folder mounted into the container."}),e?a.jsx("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(0,0,0,0.02)",marginBottom:16},children:e}):null,r?a.jsx("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(255,200,0,0.08)",marginBottom:16},children:r}):null,(0,a.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[a.jsx("h2",{style:{marginTop:0},children:"Maintenance"}),(0,a.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:12},children:["Sane defaults: these actions are ",a.jsx("b",{children:"destructive"})," and cannot be undone."]}),(0,a.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[a.jsx("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete ALL data (performers, indexed media, settings) and clear caches?")){s("clean-db"),n("Running: clean whole database...");try{let e=await fetch("/api/maintenance/clean-db",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);n("✅ Clean whole database complete.")}catch(e){n(`❌ Clean whole database failed: ${e?.message||e}`)}finally{s("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean whole database"}),a.jsx("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete indexed media only (media index + links) and clear thumbnail caches?")){s("clean-indexed"),n("Running: clean indexed files...");try{let e=await fetch("/api/maintenance/clean-indexed",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);n("✅ Clean indexed files complete.")}catch(e){n(`❌ Clean indexed files failed: ${e?.message||e}`)}finally{s("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean indexed files"}),a.jsx("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete ALL performers and their links (keeps settings). Also clears caches.")){s("clean-performers"),n("Running: clean performers...");try{let e=await fetch("/api/maintenance/clean-performers",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);n("✅ Clean performers complete.")}catch(e){n(`❌ Clean performers failed: ${e?.message||e}`)}finally{s("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean performers"})]})]}),(0,a.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[a.jsx("h2",{style:{marginTop:0},children:"Index sample_media"}),(0,a.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["This scans all files under ",a.jsx("code",{children:"/media"})," (mounted from ",a.jsx("code",{children:"./sample_media"}),"), stores them in the DB, and matches performers with media files."]}),a.jsx("button",{onClick:k,disabled:b,style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:b?"rgba(0,0,0,0.04)":"white",cursor:b?"not-allowed":"pointer"},children:b?"Indexing...":"Index now"}),g.length>0?a.jsx("div",{style:{marginTop:12,padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(0,0,0,0.02)",maxHeight:400,overflow:"auto",fontFamily:"ui-monospace, SFMono-Regular",fontSize:12,lineHeight:1.6},children:g.map((e,t)=>a.jsx("div",{style:{marginBottom:4},children:e},t))}):null]}),(0,a.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[a.jsx("h2",{style:{marginTop:0},children:"Import Performers CSV"}),a.jsx("input",{type:"file",accept:".csv,text/csv",onChange:e=>{let t=e.target.files?.[0];t&&v(t)}}),(0,a.jsxs)("div",{style:{marginTop:10,fontSize:13,opacity:.75},children:["Required header: ",a.jsx("code",{children:"Name"}),". Use the same headers as listed in README.md."]})]}),(0,a.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white"},children:[a.jsx("h2",{style:{marginTop:0},children:"Browse Media Folder"}),(0,a.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["Containers can only see folders mounted into ",a.jsx("code",{children:"/media"}),". Current selected folder is stored in the DB."]}),(0,a.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["Selected path: ",a.jsx("code",{children:d?.selected_path||"(loading...)"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:12},children:[a.jsx("button",{onClick:()=>j(""),style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},disabled:u,children:"Browse /media (root)"}),a.jsx("button",{onClick:()=>S(c),style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Select current folder"}),(0,a.jsxs)("div",{style:{fontSize:13,opacity:.75},children:["Current folder: ",a.jsx("code",{children:c||"(root)"})]})]}),(0,a.jsxs)("div",{style:{border:"1px solid rgba(0,0,0,0.1)",borderRadius:12,overflow:"hidden"},children:[h.map(e=>(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12,padding:"10px 12px",borderTop:"1px solid rgba(0,0,0,0.06)",alignItems:"center"},children:[(0,a.jsxs)("div",{style:{fontFamily:"ui-monospace, SFMono-Regular",fontSize:13},children:[e.is_dir?"\uD83D\uDCC1":"\uD83D\uDCC4"," ",e.name]}),a.jsx("div",{style:{display:"flex",gap:8},children:e.is_dir?(0,a.jsxs)(a.Fragment,{children:[a.jsx("button",{onClick:()=>j(e.rel_path),style:{padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.15)",background:"white"},disabled:u,children:"Open"}),a.jsx("button",{onClick:()=>S(e.rel_path),style:{padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Select"})]}):null})]},e.rel_path)),0===h.length?a.jsx("div",{style:{padding:12,fontSize:13,opacity:.7},children:"No items (or folder not accessible)."}):null]})]})]})}},4403:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n,metadata:()=>i});var a=r(2051);let i={title:"indexxxer"};function n({children:e}){return a.jsx("html",{lang:"en",children:a.jsx("body",{style:{margin:0,fontFamily:"ui-sans-serif, system-ui"},children:e})})}},2709:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(5347).createProxy)(String.raw`/home/project/frontend/app/tools/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,39],()=>r(1518));module.exports=a})();