(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[843],{4902:function(e,t,a){Promise.resolve().then(a.bind(a,7867))},7867:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return r}});var i=a(7437),n=a(2265);function r(){let[e,t]=(0,n.useState)(""),[a,r]=(0,n.useState)(""),[o,d]=(0,n.useState)(""),[l,s]=(0,n.useState)(null),[c,p]=(0,n.useState)(""),[h,u]=(0,n.useState)([]),[m,f]=(0,n.useState)(!1),[x,g]=(0,n.useState)([]),[b,y]=(0,n.useState)(!1);async function w(){try{let e=await fetch("/api/media/current",{cache:"no-store"});if(!e.ok){let a=await e.text().catch(()=>"");t("Media current failed: ".concat(e.status," ").concat(a?"- "+a:""));return}let a=await e.json();s(a)}catch(e){t("Media current fetch failed: ".concat((null==e?void 0:e.message)||e))}}async function j(e){f(!0),t("");try{let a=new URL("/api/media/browse",window.location.origin);e&&a.searchParams.set("path",e);let i=await fetch(a.toString(),{cache:"no-store"});if(!i.ok){let e=await i.text().catch(()=>"");t("Browse failed: ".concat(i.status," ").concat(e?"- "+e:"")),u([]);return}let n=await i.json();p(n.current_rel_path||""),u(n.items||[])}catch(e){t("Browse fetch failed: ".concat((null==e?void 0:e.message)||e)),u([])}finally{f(!1)}}async function S(e){t("");try{let a=await fetch("/api/media/select?rel_path=".concat(encodeURIComponent(e)),{method:"POST"});if(!a.ok){let e=await a.text().catch(()=>"");t("Select failed: ".concat(a.status," ").concat(e?"- "+e:""));return}await w(),t("Selected: ".concat(e||"(root)"))}catch(e){t("Select fetch failed: ".concat((null==e?void 0:e.message)||e))}}async function k(e){t("");try{let a=new FormData;a.append("file",e);let i=await fetch("/api/performers/import-csv",{method:"POST",body:a}),n=await i.text().catch(()=>""),r={};try{r=n?JSON.parse(n):{}}catch(e){r={raw:n}}if(!i.ok){t("CSV import failed: ".concat(i.status," ").concat(JSON.stringify(r)));return}t("CSV import OK: created=".concat(r.created," updated=").concat(r.updated))}catch(e){t("CSV import fetch failed: ".concat((null==e?void 0:e.message)||e))}}async function v(){g(["Starting indexing..."]),y(!0),t("");try{var e;let t=await fetch("/api/media/index",{method:"POST"});if(!t.ok){let e=await t.text();g(a=>[...a,"Error: ".concat(t.status," ").concat(e)]),y(!1);return}let a=null===(e=t.body)||void 0===e?void 0:e.getReader();if(!a){g(e=>[...e,"Error: No response body"]),y(!1);return}let i=new TextDecoder,n="";for(;;){let{done:e,value:t}=await a.read();if(e)break;let r=(n+=i.decode(t,{stream:!0})).split("\n");for(let e of(n=r.pop()||"",r))if(e.trim()&&e.startsWith("data: "))try{let t=JSON.parse(e.slice(6)),a=new Date(t.timestamp).toLocaleTimeString(),i="[".concat(a,"] ").concat(t.message);g(e=>[...e,i])}catch(t){g(t=>[...t,"Parse error: ".concat(e)])}}g(e=>[...e,"Indexing complete!"])}catch(e){g(t=>[...t,"Error: ".concat((null==e?void 0:e.message)||e)])}finally{y(!1)}}return(0,n.useEffect)(()=>{w(),j("")},[]),(0,i.jsxs)("main",{style:{padding:24,maxWidth:1100,margin:"0 auto"},children:[(0,i.jsx)("a",{href:"/",style:{textDecoration:"none",color:"black",opacity:.75},children:"← Back"}),(0,i.jsx)("h1",{style:{marginTop:10,marginBottom:6},children:"Tools"}),(0,i.jsx)("div",{style:{opacity:.7,marginBottom:18},children:"Import performer CSV and browse/select a media folder mounted into the container."}),e?(0,i.jsx)("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(0,0,0,0.02)",marginBottom:16},children:e}):null,a?(0,i.jsx)("div",{style:{padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(255,200,0,0.08)",marginBottom:16},children:a}):null,(0,i.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Maintenance"}),(0,i.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:12},children:["Sane defaults: these actions are ",(0,i.jsx)("b",{children:"destructive"})," and cannot be undone."]}),(0,i.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:10},children:[(0,i.jsx)("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete ALL data (performers, indexed media, settings) and clear caches?")){d("clean-db"),r("Running: clean whole database...");try{let e=await fetch("/api/maintenance/clean-db",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);r("✅ Clean whole database complete.")}catch(e){r("❌ Clean whole database failed: ".concat((null==e?void 0:e.message)||e))}finally{d("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean whole database"}),(0,i.jsx)("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete indexed media only (media index + links) and clear thumbnail caches?")){d("clean-indexed"),r("Running: clean indexed files...");try{let e=await fetch("/api/maintenance/clean-indexed",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);r("✅ Clean indexed files complete.")}catch(e){r("❌ Clean indexed files failed: ".concat((null==e?void 0:e.message)||e))}finally{d("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean indexed files"}),(0,i.jsx)("button",{disabled:!!o,onClick:async()=>{if(confirm("Delete ALL performers and their links (keeps settings). Also clears caches.")){d("clean-performers"),r("Running: clean performers...");try{let e=await fetch("/api/maintenance/clean-performers",{method:"POST"}),t=await e.text();if(!e.ok)throw Error(t);r("✅ Clean performers complete.")}catch(e){r("❌ Clean performers failed: ".concat((null==e?void 0:e.message)||e))}finally{d("")}}},style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Clean performers"})]})]}),(0,i.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Index sample_media"}),(0,i.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["This scans all files under ",(0,i.jsx)("code",{children:"/media"})," (mounted from ",(0,i.jsx)("code",{children:"./sample_media"}),"), stores them in the DB, and matches performers with media files."]}),(0,i.jsx)("button",{onClick:v,disabled:b,style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:b?"rgba(0,0,0,0.04)":"white",cursor:b?"not-allowed":"pointer"},children:b?"Indexing...":"Index now"}),x.length>0?(0,i.jsx)("div",{style:{marginTop:12,padding:12,borderRadius:12,border:"1px solid rgba(0,0,0,0.12)",background:"rgba(0,0,0,0.02)",maxHeight:400,overflow:"auto",fontFamily:"ui-monospace, SFMono-Regular",fontSize:12,lineHeight:1.6},children:x.map((e,t)=>(0,i.jsx)("div",{style:{marginBottom:4},children:e},t))}):null]}),(0,i.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white",marginBottom:16},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Import Performers CSV"}),(0,i.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&k(a)}}),(0,i.jsxs)("div",{style:{marginTop:10,fontSize:13,opacity:.75},children:["Required header: ",(0,i.jsx)("code",{children:"Name"}),". Use the same headers as listed in README.md."]})]}),(0,i.jsxs)("section",{style:{border:"1px solid rgba(0,0,0,0.12)",borderRadius:16,padding:16,background:"white"},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Browse Media Folder"}),(0,i.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["Containers can only see folders mounted into ",(0,i.jsx)("code",{children:"/media"}),". Current selected folder is stored in the DB."]}),(0,i.jsxs)("div",{style:{fontSize:13,opacity:.75,marginBottom:10},children:["Selected path: ",(0,i.jsx)("code",{children:(null==l?void 0:l.selected_path)||"(loading...)"})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:10,flexWrap:"wrap",alignItems:"center",marginBottom:12},children:[(0,i.jsx)("button",{onClick:()=>j(""),style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},disabled:m,children:"Browse /media (root)"}),(0,i.jsx)("button",{onClick:()=>S(c),style:{padding:"10px 12px",borderRadius:12,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Select current folder"}),(0,i.jsxs)("div",{style:{fontSize:13,opacity:.75},children:["Current folder: ",(0,i.jsx)("code",{children:c||"(root)"})]})]}),(0,i.jsxs)("div",{style:{border:"1px solid rgba(0,0,0,0.1)",borderRadius:12,overflow:"hidden"},children:[h.map(e=>(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12,padding:"10px 12px",borderTop:"1px solid rgba(0,0,0,0.06)",alignItems:"center"},children:[(0,i.jsxs)("div",{style:{fontFamily:"ui-monospace, SFMono-Regular",fontSize:13},children:[e.is_dir?"\uD83D\uDCC1":"\uD83D\uDCC4"," ",e.name]}),(0,i.jsx)("div",{style:{display:"flex",gap:8},children:e.is_dir?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:()=>j(e.rel_path),style:{padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.15)",background:"white"},disabled:m,children:"Open"}),(0,i.jsx)("button",{onClick:()=>S(e.rel_path),style:{padding:"8px 10px",borderRadius:10,border:"1px solid rgba(0,0,0,0.15)",background:"white"},children:"Select"})]}):null})]},e.rel_path)),0===h.length?(0,i.jsx)("div",{style:{padding:12,fontSize:13,opacity:.7},children:"No items (or folder not accessible)."}):null]})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=4902)}),_N_E=e.O()}]);