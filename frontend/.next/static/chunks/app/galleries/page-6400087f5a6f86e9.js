(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[519],{7518:function(e,t,r){Promise.resolve().then(r.bind(r,2192))},2192:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(7437),o=r(2265),a=r(9376);function i(e){let t=e.split("/").filter(Boolean);return t.length?t[t.length-1]:e}function l(){let e=(0,a.useRouter)(),t=(0,a.useSearchParams)(),[r,l]=(0,o.useState)([]),[s,d]=(0,o.useState)(""),[c,u]=(0,o.useState)([]),[p,g]=(0,o.useState)(!1),[h,x]=(0,o.useState)(""),[b,f]=(0,o.useState)(!1),[m,y]=(0,o.useState)(""),[v,w]=(0,o.useState)(-1),[S,k]=(0,o.useState)("");(0,o.useEffect)(()=>{if(!b)return;let e=e=>{if("Escape"===e.key){f(!1);return}if("ArrowLeft"!==e.key&&"ArrowRight"!==e.key||(e.preventDefault(),!S||v<0||0===c.length))return;let t=v+("ArrowRight"===e.key?1:-1);if(t<0&&(t=0),t>=c.length&&(t=c.length-1),t===v)return;w(t);let r=c[t];y("/api/zip/image?rel_path=".concat(encodeURIComponent(S),"&entry=").concat(encodeURIComponent(r)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b,v,S,c]);let j=e=>{if(!S||v<0||0===c.length)return;let t=v+e;if(t<0&&(t=0),t>=c.length&&(t=c.length-1),t===v)return;w(t);let r=c[t];y("/api/zip/image?rel_path=".concat(encodeURIComponent(S),"&entry=").concat(encodeURIComponent(r)))};(0,o.useEffect)(()=>{(async()=>{x("");try{let e=await fetch("/api/media/items",{cache:"no-store"}),t=await e.json(),r=Array.isArray(t)?t:(null==t?void 0:t.items)||[];l(r)}catch(e){x((null==e?void 0:e.message)||String(e))}})()},[]);let C=(0,o.useMemo)(()=>r.filter(e=>"zip"===e.kind).sort((e,t)=>e.rel_path.localeCompare(t.rel_path)),[r]);return(0,o.useEffect)(()=>{let e=t.get("path")||"";e&&e!==s&&d(e)},[t]),(0,o.useEffect)(()=>{let e=new AbortController;return(async()=>{if(!s){u([]),g(!1);return}x(""),g(!0),u([]);try{let t=await fetch("/api/zip/entries?rel_path=".concat(encodeURIComponent(s)),{cache:"no-store",signal:e.signal});if(!t.ok){let r=await t.text().catch(()=>"");e.signal.aborted||x("Failed to load zip entries: ".concat(t.status," ").concat(r)),e.signal.aborted||u([]);return}let r=await t.json();e.signal.aborted||u(Array.isArray(null==r?void 0:r.entries)?r.entries:[])}catch(t){e.signal.aborted||x((null==t?void 0:t.message)||String(t))}finally{e.signal.aborted||g(!1)}})(),()=>e.abort()},[s]),(0,n.jsxs)("main",{style:{padding:24,maxWidth:1400,margin:"0 auto",background:"linear-gradient(to bottom, #f8f9fa 0%, #ffffff 100%)",minHeight:"100vh"},children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:24},children:[(0,n.jsx)("a",{href:"/",style:{textDecoration:"none",color:"#667eea",fontWeight:500,display:"flex",alignItems:"center",gap:4},children:"← Back"}),(0,n.jsx)("h1",{style:{margin:0,fontSize:28,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"Galleries"}),(0,n.jsxs)("div",{style:{fontSize:13,opacity:.5,background:"white",padding:"4px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"},children:[C.length," total"]})]}),h?(0,n.jsx)("div",{style:{marginTop:12,padding:14,borderRadius:16,border:"1px solid rgba(239, 68, 68, 0.3)",background:"rgba(239, 68, 68, 0.08)",color:"#dc2626"},children:h}):null,s?(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[(0,n.jsx)("button",{onClick:()=>{d(""),u([]),f(!1),e.replace("/galleries")},style:{padding:"8px 14px",borderRadius:10,border:"1px solid rgba(0,0,0,0.1)",background:"white",cursor:"pointer",fontSize:13,fontWeight:500,color:"#667eea"},children:"← All Galleries"}),(0,n.jsx)("div",{style:{fontSize:16,fontWeight:600,color:"#1f2937"},children:i(s)}),(0,n.jsx)("div",{style:{fontSize:13,opacity:.5,background:"white",padding:"4px 10px",borderRadius:8,border:"1px solid rgba(0,0,0,0.06)"},children:p?"Loading…":"".concat(c.length," images")})]}),p?(0,n.jsx)("div",{style:{padding:48,textAlign:"center",borderRadius:16,border:"2px dashed rgba(0,0,0,0.1)",opacity:.6},children:(0,n.jsx)("div",{style:{fontSize:14},children:"Loading gallery…"})}):(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:12},children:c.map((e,t)=>(0,n.jsx)("button",{onClick:()=>{y("/api/zip/image?rel_path=".concat(encodeURIComponent(s),"&entry=").concat(encodeURIComponent(e))),w(t),k(s),f(!0)},title:e,style:{padding:0,border:"none",borderRadius:12,overflow:"hidden",background:"white",cursor:"zoom-in",boxShadow:"0 2px 8px rgba(0,0,0,0.08)",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 4px 16px rgba(0,0,0,0.12)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 8px rgba(0,0,0,0.08)"},children:(0,n.jsx)("img",{src:"/api/zip/thumb?rel_path=".concat(encodeURIComponent(s),"&entry=").concat(encodeURIComponent(e),"&size=360"),alt:e,style:{width:"100%",height:200,objectFit:"cover",display:"block"},loading:"lazy"})},"".concat(s,"::").concat(e)))})]}):(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{fontSize:14,opacity:.6,marginBottom:16},children:"Select a gallery to view its contents"}),(0,n.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:16},children:[C.map(t=>(0,n.jsxs)("button",{onClick:()=>{var r;d(r=t.rel_path),f(!1),y(""),w(-1),k(""),e.replace("/galleries?path=".concat(encodeURIComponent(r)))},style:{textAlign:"left",padding:20,borderRadius:16,border:"none",background:"white",cursor:"pointer",boxShadow:"0 2px 12px rgba(0,0,0,0.06), 0 0 0 1px rgba(0,0,0,0.04)",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.1), 0 0 0 1px rgba(0,0,0,0.06)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 2px 12px rgba(0,0,0,0.06), 0 0 0 1px rgba(0,0,0,0.04)"},children:[(0,n.jsx)("div",{style:{fontSize:32,marginBottom:12},children:"\uD83D\uDCC1"}),(0,n.jsx)("div",{style:{fontSize:15,fontWeight:600,marginBottom:6,color:"#1f2937",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:t.rel_path,children:i(t.rel_path)}),(0,n.jsx)("div",{style:{fontSize:12,opacity:.5},children:"Click to view"})]},t.rel_path)),C.length?null:(0,n.jsxs)("div",{style:{gridColumn:"1 / -1",padding:48,textAlign:"center",borderRadius:16,border:"2px dashed rgba(0,0,0,0.1)",opacity:.6},children:[(0,n.jsx)("div",{style:{fontSize:48,marginBottom:16},children:"\uD83D\uDCE6"}),(0,n.jsxs)("div",{style:{fontSize:14},children:["No galleries found. Use ",(0,n.jsx)("b",{children:"Tools → Index now"})," to scan your media."]})]})]})]}),b?(0,n.jsx)("div",{onClick:()=>f(!1),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.8)",display:"grid",placeItems:"center",padding:24,zIndex:9999,cursor:"zoom-out"},children:(0,n.jsxs)("div",{onClick:e=>e.stopPropagation(),style:{position:"relative",maxWidth:"95vw",maxHeight:"95vh",display:"grid",placeItems:"center",cursor:"default"},children:[(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),j(-1)},"aria-label":"Previous",title:"Previous (←)",style:{position:"absolute",left:-12,top:"50%",transform:"translate(-100%, -50%)",border:"none",background:"rgba(255,255,255,0.15)",color:"white",width:44,height:44,borderRadius:999,fontSize:28,lineHeight:"44px",cursor:"pointer",userSelect:"none"},children:"‹"}),(0,n.jsx)("img",{src:m,alt:"Full size",style:{maxWidth:"95vw",maxHeight:"95vh",borderRadius:12,boxShadow:"0 20px 50px rgba(0,0,0,0.35)",cursor:"default"}}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),j(1)},"aria-label":"Next",title:"Next (→)",style:{position:"absolute",right:-12,top:"50%",transform:"translate(100%, -50%)",border:"none",background:"rgba(255,255,255,0.15)",color:"white",width:44,height:44,borderRadius:999,fontSize:28,lineHeight:"44px",cursor:"pointer",userSelect:"none"},children:"›"}),(0,n.jsx)("div",{style:{position:"absolute",bottom:-10,transform:"translateY(100%)",color:"rgba(255,255,255,0.85)",fontSize:12,userSelect:"none"},children:v>=0?"".concat(v+1," / ").concat(c.length):""})]})}):null]})}},9376:function(e,t,r){"use strict";var n=r(5475);r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})}},function(e){e.O(0,[971,117,744],function(){return e(e.s=7518)}),_N_E=e.O()}]);